import React, { useState } from 'react';\nimport {\n  X,\n  Search,\n  Grid3X3,\n  List,\n  Upload,\n  CheckCircle,\n  Image as ImageIcon,\n  Video,\n  FileText,\n  Music,\n  Archive,\n} from 'lucide-react';\nimport useMediaLibrary, { MediaFile } from '../../hooks/useMediaLibrary';\nimport useImageSelector, { ImageSelectorOptions } from '../../hooks/useImageSelector';\n\ninterface ImageSelectorModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSelect: (files: MediaFile[]) => void;\n  options?: ImageSelectorOptions;\n  title?: string;\n}\n\nexport default function ImageSelectorModal({\n  isOpen,\n  onClose,\n  onSelect,\n  options = {},\n  title = \"Seleccionar Imagen\"\n}: ImageSelectorModalProps) {\n  const {\n    files,\n    loading,\n    error,\n    formatFileSize,\n  } = useMediaLibrary();\n\n  const {\n    selectedImages,\n    selectImage,\n    confirmSelection,\n    filterFiles,\n    allowMultiple,\n    maxSelection,\n    canConfirm,\n  } = useImageSelector(options);\n\n  const [viewMode, setViewMode] = useState<'grid' | 'list'>('grid');\n  const [searchTerm, setSearchTerm] = useState('');\n\n  if (!isOpen) return null;\n\n  const getFileIcon = (type: string) => {\n    switch (type) {\n      case \"image\":\n        return ImageIcon;\n      case \"video\":\n        return Video;\n      case \"document\":\n        return FileText;\n      case \"audio\":\n        return Music;\n      case \"archive\":\n        return Archive;\n      default:\n        return FileText;\n    }\n  };\n\n  const getFileTypeColor = (type: string) => {\n    switch (type) {\n      case \"image\":\n        return \"bg-green-100 text-green-800\";\n      case \"video\":\n        return \"bg-purple-100 text-purple-800\";\n      case \"document\":\n        return \"bg-blue-100 text-blue-800\";\n      case \"audio\":\n        return \"bg-yellow-100 text-yellow-800\";\n      case \"archive\":\n        return \"bg-gray-100 text-gray-800\";\n      default:\n        return \"bg-gray-100 text-gray-800\";\n    }\n  };\n\n  // Filtrar archivos por tipo y búsqueda\n  const filteredFiles = filterFiles(files).filter(file => \n    file.name.toLowerCase().includes(searchTerm.toLowerCase()) ||\n    file.tags.some(tag => tag.toLowerCase().includes(searchTerm.toLowerCase()))\n  );\n\n  const handleSelect = (file: MediaFile) => {\n    if (!allowMultiple) {\n      onSelect([file]);\n      onClose();\n      return;\n    }\n    selectImage(file);\n  };\n\n  const handleConfirm = () => {\n    onSelect(selectedImages);\n    onClose();\n  };\n\n  const isSelected = (fileId: string) => {\n    return selectedImages.some(f => f.id === fileId);\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50\">\n      <div className=\"bg-white rounded-lg max-w-6xl w-full max-h-[90vh] overflow-hidden flex flex-col\">\n        {/* Header */}\n        <div className=\"p-6 border-b border-gray-200\">\n          <div className=\"flex justify-between items-center\">\n            <div>\n              <h2 className=\"text-xl font-semibold text-gray-900\">{title}</h2>\n              <p className=\"text-sm text-gray-600 mt-1\">\n                {allowMultiple \n                  ? `Selecciona hasta ${maxSelection} archivo${maxSelection !== 1 ? 's' : ''}`\n                  : 'Selecciona un archivo'\n                }\n              </p>\n            </div>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-gray-100 rounded-lg transition-colors\"\n            >\n              <X className=\"w-5 h-5\" />\n            </button>\n          </div>\n          \n          {/* Toolbar */}\n          <div className=\"flex flex-col sm:flex-row gap-4 mt-4\">\n            <div className=\"relative flex-1\">\n              <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n              <input\n                type=\"text\"\n                placeholder=\"Buscar archivos...\"\n                value={searchTerm}\n                onChange={(e) => setSearchTerm(e.target.value)}\n                className=\"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0d40a5] focus:border-[#0d40a5]\"\n              />\n            </div>\n            <button\n              onClick={() => setViewMode(viewMode === 'grid' ? 'list' : 'grid')}\n              className=\"p-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n            >\n              {viewMode === 'grid' ? <List className=\"w-4 h-4\" /> : <Grid3X3 className=\"w-4 h-4\" />}\n            </button>\n          </div>\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {loading ? (\n            <div className=\"flex items-center justify-center py-12\">\n              <div className=\"text-center\">\n                <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-[#0d40a5] mx-auto mb-4\"></div>\n                <p className=\"text-gray-600\">Cargando archivos...</p>\n              </div>\n            </div>\n          ) : error ? (\n            <div className=\"text-center py-12\">\n              <p className=\"text-red-600 mb-4\">{error}</p>\n            </div>\n          ) : filteredFiles.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <ImageIcon className=\"w-16 h-16 text-gray-300 mx-auto mb-4\" />\n              <h3 className=\"text-lg font-medium text-gray-900 mb-2\">\n                No se encontraron archivos\n              </h3>\n              <p className=\"text-gray-600\">\n                {searchTerm \n                  ? 'Ajusta los términos de búsqueda'\n                  : 'No hay archivos disponibles'\n                }\n              </p>\n            </div>\n          ) : (\n            <>\n              {/* Grid View */}\n              {viewMode === 'grid' && (\n                <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-4\">\n                  {filteredFiles.map((file) => {\n                    const FileIcon = getFileIcon(file.type);\n                    const selected = isSelected(file.id);\n                    \n                    return (\n                      <div\n                        key={file.id}\n                        className={`group bg-white rounded-lg border-2 overflow-hidden cursor-pointer transition-all hover:shadow-md ${\n                          selected ? \"border-[#0d40a5] shadow-md\" : \"border-gray-200\"\n                        }`}\n                        onClick={() => handleSelect(file)}\n                      >\n                        <div className=\"aspect-square bg-gray-100 relative\">\n                          {file.type === \"image\" && file.thumbnail ? (\n                            <img\n                              src={file.thumbnail}\n                              alt={file.name}\n                              className=\"w-full h-full object-cover\"\n                            />\n                          ) : (\n                            <div className=\"w-full h-full flex items-center justify-center\">\n                              <FileIcon className=\"w-12 h-12 text-gray-400\" />\n                            </div>\n                          )}\n                          \n                          {selected && (\n                            <div className=\"absolute inset-0 bg-[#0d40a5] bg-opacity-20 flex items-center justify-center\">\n                              <div className=\"w-6 h-6 bg-[#0d40a5] rounded-full flex items-center justify-center\">\n                                <CheckCircle className=\"w-4 h-4 text-white fill-current\" />\n                              </div>\n                            </div>\n                          )}\n                          \n                          <div className=\"absolute top-2 left-2\">\n                            <span className={`px-2 py-1 text-xs rounded-full ${getFileTypeColor(file.type)}`}>\n                              {file.type}\n                            </span>\n                          </div>\n                        </div>\n                        \n                        <div className=\"p-3\">\n                          <h4 className=\"text-sm font-medium text-gray-900 truncate\" title={file.name}>\n                            {file.name}\n                          </h4>\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            {formatFileSize(file.size)}\n                          </p>\n                          {file.dimensions && (\n                            <p className=\"text-xs text-gray-500\">\n                              {file.dimensions.width} × {file.dimensions.height}\n                            </p>\n                          )}\n                        </div>\n                      </div>\n                    );\n                  })}\n                </div>\n              )}\n\n              {/* List View */}\n              {viewMode === 'list' && (\n                <div className=\"bg-white rounded-lg border border-gray-200\">\n                  <div className=\"overflow-x-auto\">\n                    <table className=\"w-full\">\n                      <thead className=\"bg-gray-50 border-b\">\n                        <tr>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Archivo\n                          </th>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Tipo\n                          </th>\n                          <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                            Tamaño\n                          </th>\n                        </tr>\n                      </thead>\n                      <tbody className=\"bg-white divide-y divide-gray-200\">\n                        {filteredFiles.map((file) => {\n                          const FileIcon = getFileIcon(file.type);\n                          const selected = isSelected(file.id);\n                          \n                          return (\n                            <tr \n                              key={file.id} \n                              className={`hover:bg-gray-50 cursor-pointer ${\n                                selected ? \"bg-blue-50\" : \"\"\n                              }`}\n                              onClick={() => handleSelect(file)}\n                            >\n                              <td className=\"px-6 py-4 whitespace-nowrap\">\n                                <div className=\"flex items-center gap-3\">\n                                  <div className=\"w-10 h-10 bg-gray-100 rounded-lg flex items-center justify-center relative\">\n                                    {file.type === \"image\" && file.thumbnail ? (\n                                      <img\n                                        src={file.thumbnail}\n                                        alt={file.name}\n                                        className=\"w-10 h-10 object-cover rounded-lg\"\n                                      />\n                                    ) : (\n                                      <FileIcon className=\"w-5 h-5 text-gray-400\" />\n                                    )}\n                                    {selected && (\n                                      <div className=\"absolute -top-1 -right-1 w-4 h-4 bg-[#0d40a5] rounded-full flex items-center justify-center\">\n                                        <CheckCircle className=\"w-3 h-3 text-white fill-current\" />\n                                      </div>\n                                    )}\n                                  </div>\n                                  <div>\n                                    <p className=\"text-sm font-medium text-gray-900\">{file.name}</p>\n                                    <p className=\"text-xs text-gray-500\">{file.folder}</p>\n                                  </div>\n                                </div>\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap\">\n                                <span className={`px-2 py-1 text-xs rounded-full ${getFileTypeColor(file.type)}`}>\n                                  {file.type}\n                                </span>\n                              </td>\n                              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                                {formatFileSize(file.size)}\n                              </td>\n                            </tr>\n                          );\n                        })}\n                      </tbody>\n                    </table>\n                  </div>\n                </div>\n              )}\n            </>\n          )}\n        </div>\n\n        {/* Footer */}\n        {allowMultiple && (\n          <div className=\"p-6 border-t border-gray-200\">\n            <div className=\"flex justify-between items-center\">\n              <div className=\"text-sm text-gray-600\">\n                {selectedImages.length} de {maxSelection} seleccionados\n              </div>\n              <div className=\"flex gap-3\">\n                <button\n                  onClick={onClose}\n                  className=\"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors\"\n                >\n                  Cancelar\n                </button>\n                <button\n                  onClick={handleConfirm}\n                  disabled={!canConfirm}\n                  className=\"px-4 py-2 bg-[#0d40a5] text-white rounded-lg hover:bg-[#0d40a5]/90 transition-colors disabled:opacity-50\"\n                >\n                  Confirmar Selección\n                </button>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}"