import { useState, useEffect } from 'react';\nimport { Plus, Edit, Trash2, Eye, EyeOff, Save } from 'lucide-react';\nimport { blogPostAPI } from '@/services/api';\nimport type { BlogPost } from '@/types';\n\ninterface BlogEditorProps {\n  onRefresh?: () => void;\n}\n\nexport default function BlogEditor({ onRefresh }: BlogEditorProps) {\n  const [posts, setPosts] = useState<BlogPost[]>([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [editingPost, setEditingPost] = useState<BlogPost | null>(null);\n  const [isCreating, setIsCreating] = useState(false);\n  const [apiConnected, setApiConnected] = useState(false);\n\n  // Datos de ejemplo para cuando no hay conexi√≥n a la API\n  const mockPosts: BlogPost[] = [\n    {\n      id: \"1\",\n      title: \"Avances en Biotecnolog√≠a Nutricional\",\n      slug: \"avances-biotecnologia-nutricional\",\n      excerpt: \"Descubre las √∫ltimas investigaciones en el campo de la biotecnolog√≠a aplicada a la nutrici√≥n.\",\n      content: \"# Avances en Biotecnolog√≠a Nutricional\\n\\nLa biotecnolog√≠a nutricional ha experimentado avances significativos...\",\n      imageUrl: \"/uploads/blog-biotech.jpg\",\n      author: \"Dr. Mar√≠a Gonz√°lez\",\n      published: true,\n      views: 156,\n      createdAt: new Date(Date.now() - 86400000).toISOString(),\n      updatedAt: new Date().toISOString(),\n      publishedAt: new Date(Date.now() - 86400000).toISOString(),\n    },\n    {\n      id: \"2\",\n      title: \"Suplementos Naturales vs Sint√©ticos\",\n      slug: \"suplementos-naturales-vs-sinteticos\",\n      excerpt: \"Un an√°lisis comparativo entre suplementos de origen natural y sint√©tico.\",\n      content: \"# Suplementos Naturales vs Sint√©ticos\\n\\nEn el mundo de los suplementos nutricionales...\",\n      imageUrl: \"/uploads/blog-supplements.jpg\",\n      author: \"Dr. Carlos Ruiz\",\n      published: false,\n      views: 0,\n      createdAt: new Date(Date.now() - 172800000).toISOString(),\n      updatedAt: new Date().toISOString(),\n    },\n  ];\n\n  useEffect(() => {\n    loadPosts();\n  }, []);\n\n  const loadPosts = async () => {\n    try {\n      setLoading(true);\n      const response = await blogPostAPI.getAllAdmin();\n      \n      if (response.data.length > 0) {\n        setPosts(response.data);\n        setApiConnected(true);\n        setError(\"‚úÖ Posts cargados desde la API\");\n      } else {\n        setPosts(mockPosts);\n        setApiConnected(false);\n        setError(\"‚ö†Ô∏è API vac√≠a - usando datos de ejemplo\");\n      }\n      \n      setTimeout(() => setError(null), 3000);\n    } catch (err) {\n      console.error('Error loading posts:', err);\n      setPosts(mockPosts);\n      setApiConnected(false);\n      setError(\"‚ö†Ô∏è Sin conexi√≥n - usando datos de ejemplo\");\n      setTimeout(() => setError(null), 5000);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleTogglePublished = async (id: string) => {\n    try {\n      const post = posts.find(p => p.id === id);\n      if (!post) return;\n\n      const updatedPost = { \n        ...post, \n        published: !post.published,\n        publishedAt: !post.published ? new Date().toISOString() : null\n      };\n\n      if (apiConnected) {\n        const formData = new FormData();\n        formData.append('title', post.title);\n        formData.append('excerpt', post.excerpt);\n        formData.append('content', post.content);\n        formData.append('author', post.author);\n        formData.append('published', updatedPost.published.toString());\n        \n        await blogPostAPI.update(id, formData);\n      }\n\n      setPosts(posts.map(p => p.id === id ? updatedPost : p));\n      \n      if (onRefresh) onRefresh();\n      \n      const message = apiConnected \n        ? `‚úÖ Post ${updatedPost.published ? 'publicado' : 'despublicado'} exitosamente`\n        : `‚úÖ Post ${updatedPost.published ? 'publicado' : 'despublicado'} localmente`;\n      setError(message);\n      setTimeout(() => setError(null), 3000);\n    } catch (err) {\n      console.error('Error toggling published status:', err);\n      setError('‚ùå Error al cambiar el estado de publicaci√≥n');\n      setTimeout(() => setError(null), 3000);\n    }\n  };\n\n  const handleDeletePost = async (id: string) => {\n    if (!confirm('¬øEst√°s seguro de que quieres eliminar este post?')) return;\n    \n    try {\n      if (apiConnected) {\n        await blogPostAPI.delete(id);\n      }\n      \n      setPosts(posts.filter(p => p.id !== id));\n      \n      if (onRefresh) onRefresh();\n      \n      const message = apiConnected \n        ? '‚úÖ Post eliminado exitosamente'\n        : '‚úÖ Post eliminado localmente';\n      setError(message);\n      setTimeout(() => setError(null), 3000);\n    } catch (err) {\n      console.error('Error deleting post:', err);\n      setError('‚ùå Error al eliminar el post');\n      setTimeout(() => setError(null), 3000);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"p-6 flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-[#0d40a5] mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Cargando posts del blog...</p>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"p-6 max-w-6xl mx-auto\">\n      {/* Header */}\n      <div className=\"flex justify-between items-center mb-6\">\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\">Gesti√≥n del Blog</h1>\n          <p className=\"text-gray-600 mt-1\">\n            Administra los art√≠culos y publicaciones del blog\n          </p>\n        </div>\n        <button\n          onClick={() => {\n            setIsCreating(true);\n            // TODO: Implementar creaci√≥n de nuevo post\n            alert('Funcionalidad de crear nuevo post pendiente de implementar');\n          }}\n          className=\"flex items-center gap-2 px-4 py-2 bg-[#0d40a5] text-white rounded-lg hover:bg-[#0d40a5]/90 transition-colors\"\n        >\n          <Plus className=\"w-4 h-4\" />\n          Nuevo Post\n        </button>\n      </div>\n\n      {/* Status indicator */}\n      <div className={`mb-4 px-4 py-2 rounded-lg ${\n        apiConnected \n          ? 'bg-green-100 text-green-800' \n          : 'bg-yellow-100 text-yellow-800'\n      }`}>\n        <p className=\"text-sm\">\n          {apiConnected \n            ? 'üü¢ Conectado a la API - datos en tiempo real'\n            : 'üü° Modo local - cambios no se guardan en el servidor'\n          }\n        </p>\n      </div>\n\n      {/* Posts Grid */}\n      <div className=\"grid gap-6\">\n        {posts.map((post) => (\n          <div\n            key={post.id}\n            className=\"bg-white border border-gray-200 rounded-lg p-6 shadow-sm hover:shadow-md transition-shadow\"\n          >\n            <div className=\"flex items-start justify-between\">\n              <div className=\"flex-1\">\n                <div className=\"flex items-center gap-3 mb-2\">\n                  <h3 className=\"text-lg font-semibold text-gray-900\">\n                    {post.title}\n                  </h3>\n                  <span className={`px-2 py-1 text-xs rounded-full ${\n                    post.published \n                      ? 'bg-green-100 text-green-800' \n                      : 'bg-gray-100 text-gray-800'\n                  }`}>\n                    {post.published ? 'Publicado' : 'Borrador'}\n                  </span>\n                  <span className=\"text-xs text-gray-500\">\n                    {post.views} vistas\n                  </span>\n                </div>\n                \n                <p className=\"text-gray-600 text-sm mb-2\">{post.excerpt}</p>\n                \n                <div className=\"text-xs text-gray-500 space-x-4\">\n                  <span>Autor: {post.author}</span>\n                  <span>Slug: {post.slug}</span>\n                  {post.publishedAt && (\n                    <span>\n                      Publicado: {new Date(post.publishedAt).toLocaleDateString('es-ES')}\n                    </span>\n                  )}\n                </div>\n              </div>\n              \n              <div className=\"flex items-center gap-2 ml-4\">\n                <button\n                  onClick={() => handleTogglePublished(post.id)}\n                  className={`p-2 transition-colors ${\n                    post.published\n                      ? 'text-green-600 hover:text-green-800'\n                      : 'text-gray-400 hover:text-gray-600'\n                  }`}\n                  title={post.published ? 'Despublicar' : 'Publicar'}\n                >\n                  {post.published ? <Eye className=\"w-4 h-4\" /> : <EyeOff className=\"w-4 h-4\" />}\n                </button>\n                \n                <button\n                  onClick={() => {\n                    setEditingPost(post);\n                    // TODO: Implementar edici√≥n de post\n                    alert('Funcionalidad de editar post pendiente de implementar');\n                  }}\n                  className=\"p-2 text-gray-400 hover:text-blue-600 transition-colors\"\n                  title=\"Editar\"\n                >\n                  <Edit className=\"w-4 h-4\" />\n                </button>\n                \n                <button\n                  onClick={() => handleDeletePost(post.id)}\n                  className=\"p-2 text-gray-400 hover:text-red-600 transition-colors\"\n                  title=\"Eliminar\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </button>\n              </div>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {posts.length === 0 && (\n        <div className=\"text-center py-12\">\n          <div className=\"text-gray-400 text-6xl mb-4\">üìù</div>\n          <h3 className=\"text-lg font-medium text-gray-900 mb-2\">No hay posts</h3>\n          <p className=\"text-gray-600 mb-4\">Comienza creando tu primer art√≠culo del blog</p>\n          <button\n            onClick={() => {\n              setIsCreating(true);\n              alert('Funcionalidad de crear nuevo post pendiente de implementar');\n            }}\n            className=\"px-4 py-2 bg-[#0d40a5] text-white rounded-lg hover:bg-[#0d40a5]/90 transition-colors\"\n          >\n            Crear Primer Post\n          </button>\n        </div>\n      )}\n\n      {/* Status Toast */}\n      {error && (\n        <div className={`fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg z-50 ${\n          error.includes('‚úÖ') \n            ? 'bg-green-600 text-white'\n            : error.includes('‚ö†Ô∏è')\n            ? 'bg-yellow-600 text-white'\n            : 'bg-red-600 text-white'\n        }`}>\n          <div className=\"flex items-center gap-2\">\n            <p className=\"text-sm\">{error}</p>\n            <button \n              onClick={() => setError(null)}\n              className=\"text-white/80 hover:text-white font-bold text-lg leading-none\"\n            >\n              √ó\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}